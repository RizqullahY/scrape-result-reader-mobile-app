import 'dart:io';
import 'package:archive/archive.dart';
import 'package:path_provider/path_provider.dart';
import 'package:path/path.dart' as p;

class UnzipService {
  static Future<String> unzip(String zipPath) async {
    final docs = await getApplicationDocumentsDirectory();
    final seriesName = p.basenameWithoutExtension(zipPath);
    final outDir = Directory(p.join(docs.path, 'comics', seriesName));

    if (!outDir.existsSync()) outDir.createSync(recursive: true);

    final bytes = File(zipPath).readAsBytesSync();
    final archive = ZipDecoder().decodeBytes(bytes);

    for (final f in archive) {
      final outPath = p.join(outDir.path, f.name);

      if (f.isFile) {
        File(outPath)
          ..createSync(recursive: true)
          ..writeAsBytesSync(f.content);
      } else {
        Directory(outPath).createSync(recursive: true);
      }
    }

    return outDir.path;
  }
}
unzip_service

import 'dart:io';
import 'package:path/path.dart' as p;

class StorageService {
  /// ROOT folder comics
  static Future<Directory> getComicsRoot() async {
    final dir = Directory("/data/user/0/com.example.app/app_flutter/comics");
    if (!dir.existsSync()) dir.createSync(recursive: true);
    return dir;
  }

  /// List SERIES atau CHAPTER di path manapun
  static Future<List<Directory>> listFolders(String path) async {
    final dir = Directory(path);
    if (!dir.existsSync()) return [];
    final list = dir.listSync().whereType<Directory>().toList();
    list.sort((a, b) => a.path.compareTo(b.path));
    return list;
  }

  /// List IMAGE dalam chapter
  static Future<List<File>> listImages(String chapterPath) async {
    final dir = Directory(chapterPath);
    if (!dir.existsSync()) return [];

    final images = dir
        .listSync()
        .whereType<File>()
        .where((f) {
          final n = f.path.toLowerCase();
          return n.endsWith('.jpg') ||
              n.endsWith('.jpeg') ||
              n.endsWith('.png') ||
              n.endsWith('.webp');
        })
        .toList();

    images.sort((a, b) {
      final aNum = _num(p.basename(a.path));
      final bNum = _num(p.basename(b.path));
      return aNum.compareTo(bNum);
    });

    return images;
  }

  /// Hapus folder apapun
  static Future<void> deleteDirectory(Directory dir) async {
    if (dir.existsSync()) dir.deleteSync(recursive: true);
  }

  static int _num(String name) {
    final m = RegExp(r'\d+').firstMatch(name);
    return m == null ? 0 : int.parse(m.group(0)!);
  }
}
storage_service
import 'dart:io';
import 'package:flutter/material.dart';
import '../services/storage_service.dart';
import 'reader_page.dart';
import 'package:path/path.dart' as p;

class ChapterPage extends StatelessWidget {
  final String seriesPath;
  const ChapterPage({super.key, required this.seriesPath});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Chapters')),
      body: FutureBuilder<List<Directory>>(
        future: StorageService.listFolders(seriesPath),
        builder: (_, snap) {
          if (!snap.hasData) return const Center(child: CircularProgressIndicator());

          final chapters = snap.data!;
          if (chapters.isEmpty) return const Center(child: Text("Tidak ada chapter"));

          return ListView.builder(
            itemCount: chapters.length,
            itemBuilder: (_, i) {
              final name = p.basename(chapters[i].path);
              return ListTile(
                title: Text(name),
                onTap: () {
                  Navigator.push(
                    context,
                    MaterialPageRoute(
                      builder: (_) => ReaderPage(chapterPath: chapters[i].path),
                    ),
                  );
                },
              );
            },
          );
        },
      ),
    );
  }
}
chapter_page

import 'dart:io';
import 'package:flutter/material.dart';
import 'package:file_picker/file_picker.dart';
import '../services/unzip_service.dart';
import '../services/storage_service.dart';
import 'chapter_page.dart';

class HomePage extends StatefulWidget {
  const HomePage({super.key});
  @override
  State<HomePage> createState() => _HomePageState();
}

class _HomePageState extends State<HomePage> {
  Directory? comicsRoot;

  @override
  void initState() {
    super.initState();
    _loadRoot();
  }

  Future<void> _loadRoot() async {
    final root = await StorageService.getComicsRoot();
    if (!mounted) return;
    setState(() => comicsRoot = root);
  }

  Future<void> _importZip() async {
    final res = await FilePicker.platform.pickFiles(
      type: FileType.custom,
      allowedExtensions: ['zip'],
    );
    if (res == null) return;

    await UnzipService.unzip(res.files.single.path!);

    if (!mounted) return;
    setState(() {}); // refresh

    ScaffoldMessenger.of(context).showSnackBar(
      const SnackBar(content: Text("ZIP berhasil diimport")),
    );
  }

  Future<void> _deleteFolder(Directory dir) async {
    final ok = await showDialog<bool>(
      context: context,
      builder: (_) => AlertDialog(
        title: const Text("Hapus Folder?"),
        content: Text(dir.path.split('/').last),
        actions: [
          TextButton(
              onPressed: () => Navigator.pop(context, false),
              child: const Text("Batal")),
          TextButton(
              onPressed: () => Navigator.pop(context, true),
              child: const Text("Hapus")),
        ],
      ),
    );

    if (ok == true) {
      await StorageService.deleteDirectory(dir);
      if (!mounted) return;
      setState(() {});
      ScaffoldMessenger.of(context)
          .showSnackBar(const SnackBar(content: Text("Folder dihapus")));
    }
  }

  @override
  Widget build(BuildContext context) {
    if (comicsRoot == null) {
      return const Scaffold(
        body: Center(child: CircularProgressIndicator()),
      );
    }

    return Scaffold(
      appBar: AppBar(
        title: const Text("Comic Reader"),
        actions: [
          IconButton(
            icon: const Icon(Icons.upload_file),
            onPressed: _importZip,
          ),
        ],
      ),
      body: FutureBuilder<List<Directory>>(
        future: StorageService.listFolders(comicsRoot!.path),
        builder: (_, snap) {
          if (!snap.hasData) {
            return const Center(child: CircularProgressIndicator());
          }

          final folders = snap.data!;
          if (folders.isEmpty) {
            return const Center(child: Text("Belum ada komik. Import ZIP dulu."));
          }

          return ListView.builder(
            itemCount: folders.length,
            itemBuilder: (_, i) {
              final f = folders[i];
              final name = f.path.split('/').last;
              return ListTile(
                title: Text(name),
                onTap: () {
                  Navigator.push(
                    context,
                    MaterialPageRoute(
                      builder: (_) => ChapterPage(seriesPath: f.path),
                    ),
                  );
                },
                trailing: IconButton(
                  icon: const Icon(Icons.delete, color: Colors.red),
                  onPressed: () => _deleteFolder(f),
                ),
              );
            },
          );
        },
      ),
    );
  }
}
home_page

import 'dart:io';
import 'package:flutter/material.dart';
import '../services/storage_service.dart';

class ReaderPage extends StatelessWidget {
  final String chapterPath;
  const ReaderPage({super.key, required this.chapterPath});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(title: const Text('Reader')),
      body: FutureBuilder<List<File>>(
        future: StorageService.listImages(chapterPath),
        builder: (_, snap) {
          if (!snap.hasData) return const Center(child: CircularProgressIndicator());

          final images = snap.data!;
          if (images.isEmpty) return const Center(child: Text("Tidak ada gambar"));

          return ListView.builder(
            itemCount: images.length,
            itemBuilder: (_, i) => Image.file(
              images[i],
              fit: BoxFit.fitWidth,
            ),
          );
        },
      ),
    );
  }
}
reader_page

ada beberapa masalah yang saya hadapi
1. aplikasi selalu berputar putar loading tanpa henti
2. kadang image ayng di tampilakn itu tidak berurutian padahal penamaan sudah urut misal
kalau ada puluhan berarti misal 01.jpg 02 20 21, kalau ratusan ya berarti 001,002,003.. 010 011 
3. untuk struktunya juga simpel zipnya, misal : onpiece1-5.zip/chapter 1 cahpter 2| kemudina perchapter ada banyak image imagenya gitu...

tolong kasih saran penjelasan agar bisa jalan dan digunakan secara normal

